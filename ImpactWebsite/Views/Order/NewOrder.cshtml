@model IEnumerable<ImpactWebsite.Models.OrderModels.OrderDetail>
@using ImpactWebsite.Models.OrderModels

@{
    ViewData["Title"] = "NewOrder";
    IFormatProvider fp = new System.Globalization.CultureInfo("en-CA");
}

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{ string strSpacer = "&nbsp;&nbsp;"; }

<h2 style="text-align: center;">
    <i class="fa fa-chevron-circle-down" aria-hidden="true"></i>
    @Html.Raw(strSpacer)Order Number : @ViewData["orderId"]
</h2>
<table class="table table-responsive" style="margin: 30px auto; max-width:700px;">
    <thead>
        <tr>
            <th class="col-md-0">#</th>
            <th class="col-md-pull-6">Module Name</th>
            <th class="col-md-2">Module Price</th>
        </tr>
    </thead>
    <tbody>
        @for (int i = 0; i < Model.Count(); i++)
        {
            var moduleNum = @i + 1;
            <tr>
                <td>@moduleNum</td>
                <td>@Model.ElementAt(@i).Module.ModuleName</td>
                <td>@Model.ElementAt(@i).Module.UnitPrice.Price.ToString("C0", fp)</td>
            </tr>
        }
    </tbody>
    <tr>
        <td></td>
        <td class="text-right text-danger">
            Saving
        </td>
        @if (!object.Equals(ViewBag.SelectionDiscount, "0"))
        {
            <td class="text-danger">
                -$@ViewBag.SelectionDiscount
            </td>
        }
        else
        {
            <td class="text-danger">
                0
            </td>
        }
    </tr>
    <tr>
        <td></td>
        <td class="text-right text-danger">
            Promotion
        </td>

        @if (!object.Equals((string)TempData["PromotionDiscountRate"], "0"))
        {
            <td class="text-danger">
                @TempData["PromotionDiscountRate"]
            </td>
        }
        else
        {
            <td class="text-danger">
                0
            </td>
        }
    </tr>

    <tr>
        <td></td>
        <td style="font-size: large; font-weight: bold;" align="right">
            Total to pay :
        </td>
        @if (ViewData["TotalAmountToPay"] != null)
        {
            <td>
                <b>
                    <label style="font-size: large;">$@ViewData["TotalAmountToPay"]</label>
                </b>
            </td>
        }
        else
        {
            <td><b style="font-size: large;">0</b></td>
        }
    </tr>

    <tr>
        <td></td>
        <td colspan="2">
            @if (ViewBag.PromotionStatus == PromotionStatusList.Ready)
            {
                <button id="promoCode"
                        asp-controller="Order"
                        asp-action="SubmitPromoCode"
                        class="impact-btn pull-right"
                        style="margin-top:15px;">

                    <i class="fa fa-barcode" aria-hidden="true"></i>
                    @Html.Raw(strSpacer)Promo Code

                </button>
            }
            else if (ViewBag.PromotionStatus == PromotionStatusList.Applied)
            {
                <button class="impact-btn pull-right"
                        style="margin-top:15px; pointer-events:none;">

                    <i class="fa fa-check" aria-hidden="true"></i>
                    @Html.Raw(strSpacer)Applied

                </button>
            }
            else if (ViewBag.PromotionStatus == PromotionStatusList.Used)
            {
                <button id="promoCode"
                        asp-controller="Order"
                        asp-action="SubmitPromoCode"
                        class="impact-btn pull-right"
                        style="margin-top:15px;">

                    <i class="fa fa-barcode" aria-hidden="true"></i>
                    @Html.Raw(strSpacer)Promo Code

                </button>
                <p style="text-align:center; margin-top:20px;" class="text-danger">
                    The promotion code is already used
                </p>
            }
    </tr>

</table>



<section style="width: 35%; margin: auto; text-align: center;">



    <a id="FileUpload"
       class="impact-btn neworder-btn">
        <i class="fa fa-info" aria-hidden="true"></i>
        @Html.Raw(strSpacer)Input Investment Information
    </a>

    @if (SignInManager.IsSignedIn(User))
            {
        <a href="@Url.Action("Index", "Billing",
                    new { @id = ViewData["LoggedinUserId"], @orderId = ViewData["orderId"] })"
           class="impact-btn neworder-btn">
            <i class="fa fa-credit-card" aria-hidden="true"></i>
            @Html.Raw(strSpacer)Request & Payment
        </a>
    }
    else
    {
        <button id="Charge"
                asp-controller="Order"
                asp-action="RegisterLogin"
                asp-route-id="@ViewData["orderId"]"
                class="impact-btn neworder-btn">
            <i class="fa fa-credit-card" aria-hidden="true"></i>
            @Html.Raw(strSpacer)Request & Payment
        </button>
    }

</section>


<br />
<br />

<div class="row">
    <div class="col-lg-4 col-lg-offset-4">

        <p style="font-size: small; font-weight: bold;">
            Estimate Deliver Date: @ViewData["DeliverDate"]
        </p>

        <br />

        <div class="input-group">
            <textarea class="form-control custom-control" rows="5"></textarea>
            <span class="input-group-addon btn btn-primary">Send</span>
        </div>
    </div>
</div>

<!--
<p></p>
<button class="UserNote btn btn-info"
        value="@Model.">
    Add Note
</button>
<span>@Html.Raw(strSpacer)Add note for your order</span>
    -->


<div id="AddUserForm"></div>



@section scripts
  {

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery-ui/jquery-ui.js"></script>
    <link rel="stylesheet" href="../lib/jquery-ui/themes/base/jquery-ui.css" />

    <script type="text/javascript">
        $('#promoCode').on('click', function () {
            $("#AddUserForm").dialog({
            type: 'GET',
            autoOpen: true,
            position: { my: "top", at: "top+150", of: window },
            width: 400,
            height: 150,
            resizable: true,
            title: 'Enter your promotional code',
            modal: true,
            open: function () {
                $(this).load('@Url.Action("SubmitPromoCode", "Order")');
            },
        });
        return false;
        });
    </script>

    <script type="text/javascript">
        $('#FileUpload').on('click', function () {

            $("#AddUserForm").dialog({
            type: 'GET',
            autoOpen: true,
            position: { my: "top", at: "top+150", of: window },
            width: 500,
            height: 200,
            resizable: false,
            title: 'Upload Files',
            modal: true,
            open: function () {
                $(this).load('@Url.Action("FileUpdaload", "Order")');
            },
        });
        return false;
    });
    </script>



    <!-- Not used -->
    <script type="text/javascript">
        $(document).ready(function () {
            var promotionDiscountRate = (string)@TempData["PromotionDiscountRate"];
            $('label[for="promotionDiscountRate"]').text(promotionDiscountRate);
        });
    </script>
}
